<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ansible and Python 3 &mdash; Ansible Community Documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=5707b69d" />
      <link rel="stylesheet" type="text/css" href="../_static/css/ansible.css?v=c5b67dd2" />
      <link rel="stylesheet" type="text/css" href="../_static/antsibull-minimal.css" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/css/rtd-ethical-ads.css?v=289b023e" />

  
    <link rel="shortcut icon" href="../_static/images/Ansible-Mark-RGB_Black.png"/>
    <link rel="canonical" href="https://docs.ansible.com/ansible/latest/dev_guide/developing_python_3.html"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=c7b8e248"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Debugging modules" href="debugging.html" />
    <link rel="prev" title="Conventions, tips, and pitfalls" href="developing_modules_best_practices.html" /><!-- extra head elements for Ansible beyond RTD Sphinx Theme -->
<script src="https://www.redhat.com/dtm.js"></script>


<!-- <meta class="swiftype" name="published_at" data-type="date" content="2017-12-13" /> -->
<meta class="swiftype" name="version" data-type="string" content="devel">

<!-- Google Tag Manager Data Layer -->
<script>
 dataLayer = [];
</script>
<!-- End Google Tag Manager Data Layer -->



<script>
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','https://s.swiftypecdn.com/install/v2/st.js','_st');

_st('install','yABGvz2N8PwcwBxyfzUc','2.0.0');
</script>

</head>

<body class="wy-body-for-nav"><!-- extra body elements for Ansible beyond RTD Sphinx Theme -->
<!-- Google Tag Manager -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PSB293" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-PSB293');</script>
<!-- End Google Tag Manager -->

<div class="DocSite-globalNav ansibleNav">
  <ul>
    <li><a href="https://www.ansible.com/blog" target="_blank">Blog</a></li>
    <li><a href="https://forum.ansible.com/" target="_blank">Ansible community forum</a></li>
    <li><a href="https://docs.ansible.com/" target="_blank">Documentation</a></li>
  </ul>
</div>

<a class="DocSite-nav" href="/" style="padding-bottom: 30px;">

  <img class="DocSiteNav-logo"
    src="../_static/images/Ansible-Mark-RGB_White.png"
    alt="Ansible Logo">
  <div class="DocSiteNav-title">Ansible Community Documentation</div>
</a>
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Ansible
          </a>
              <div class="version">
                devel
              </div><!--- Based on https://github.com/rtfd/sphinx_rtd_theme/pull/438/files -->

<div class="version">
  
    <form class="version-dropdown" method="get">
      <script>
        function switchVersionTo(slug) {
          var current_url_path = window.location.pathname;
          var url_version = current_url_path.search("/devel/") > -1
            ? "/devel/"
            : "/latest/";
          var new_version_url = current_url_path.replace(url_version, "/" + slug + "/");
          window.location.replace(new_version_url);
        }
      </script>
      <label class="sr-only" for="version-list">Select version:</label>
      <select
          class="version-list"
          id="version-list"
          onchange="switchVersionTo(this.value);"
      >
        
        <option
            value="latest"
            
        >
            latest
        </option>
        
        <option
            value="9"
            
        >
            9
        </option>
        
        <option
            value="2.9"
            
        >
            2.9
        </option>
        
        <option
            value="devel"
            selected="selected"
        >
            devel
        </option>
        
      </select>
    </form>
  
</div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" method="get">
    <label class="sr-only" for="q">Search docs:</label>
    <input type="text" class="st-default-search-input" id="q" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
  
              <p class="caption" role="heading"><span class="caption-text">Ansible getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/index.html">Getting started with Ansible</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started_ee/index.html">Getting started with Execution Environments</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Installation, Upgrade &amp; Configuration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation_guide/index.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../porting_guides/porting_guides.html">Ansible Porting Guides</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Using Ansible</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../inventory_guide/index.html">Building Ansible inventories</a></li>
<li class="toctree-l1"><a class="reference internal" href="../command_guide/index.html">Using Ansible command line tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../playbook_guide/index.html">Using Ansible playbooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vault_guide/index.html">Protecting sensitive data with Ansible vault</a></li>
<li class="toctree-l1"><a class="reference internal" href="../module_plugin_guide/index.html">Using Ansible modules and plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../collections_guide/index.html">Using Ansible collections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../os_guide/index.html">Using Ansible on Windows and BSD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tips_tricks/index.html">Ansible tips and tricks</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing to Ansible</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../community/index.html">Ansible Community Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../community/contributions_collections.html">Ansible Collections Contributor Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../community/contributions.html">ansible-core Contributors Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../community/advanced_index.html">Advanced Contributor Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="style_guide/index.html">Ansible documentation style guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Extending Ansible</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html">Developer Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Common Ansible Scenarios</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../scenario_guides/cloud_guides.html">Legacy Public Cloud Guides</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Network Automation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../network/getting_started/index.html">Network Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../network/user_guide/index.html">Network Advanced Topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../network/dev_guide/index.html">Network Developer Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Ansible Galaxy</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../galaxy/user_guide.html">Galaxy User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../galaxy/dev_guide.html">Galaxy Developer Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference &amp; Appendices</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../collections/index.html">Collection Index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../collections/all_plugins.html">Indexes of all modules and plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/playbooks_keywords.html">Playbook Keywords</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/common_return_values.html">Return Values</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/config.html">Ansible Configuration Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/general_precedence.html">Controlling how Ansible behaves: precedence rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/YAMLSyntax.html">YAML Syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/python_3_support.html">Python 3 Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/interpreter_discovery.html">Interpreter Discovery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/release_and_maintenance.html">Releases and maintenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/test_strategies.html">Testing Strategies</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing/sanity/index.html">Sanity Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/module_utils.html">Ansible Reference: Module Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/special_variables.html">Special Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/tower.html">Red Hat Ansible Automation Platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/automationhub.html">Ansible Automation Hub</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/logging.html">Logging Ansible output</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Roadmaps</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../roadmap/ansible_roadmap_index.html">Ansible Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../roadmap/ansible_core_roadmap_index.html">ansible-core Roadmaps</a></li>
</ul>
<!-- extra nav elements for Ansible beyond RTD Sphinx Theme -->
<!-- changeable widget links to tower - do not change as image controlled by Ansible-->
<div id="sideBanner">
  <br/>
  <a href="https://www.ansible.com/docs-left?utm_source=docs">
    <img style="border-width:0px;" src="https://cdn2.hubspot.net/hubfs/330046/docs-graphics/ASB-docs-left-rail.png" />
  </a>
  <br/><br/><br/>
</div>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Ansible</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Developer Guide</a></li>
      <li class="breadcrumb-item active">Ansible and Python 3</li>
  <li class="wy-breadcrumbs-aside">
            <!-- Remove main index page as it is no longer editable -->
            
              <a href="https://github.com/ansible/ansible-documentation/edit/devel/docs/docsite/rst/dev_guide/developing_python_3.rst?description=%23%23%23%23%23%20SUMMARY%0A%3C!---%20Your%20description%20here%20--%3E%0A%0A%0A%23%23%23%23%23%20ISSUE%20TYPE%0A-%20Docs%20Pull%20Request%0A%0A%2Blabel:%20docsite_pr" class="fa fa-github"> Edit on GitHub</a>
            
  </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
  <script>
    function startsWith(str, needle) {
      return str.slice(0, needle.length) == needle
    }
    function startsWithOneOf(str, needles) {
      return needles.some(function (needle) {
        return startsWith(str, needle);
      });
    }
    var banner = '';
      var extra_banner = '';
    /*use extra_banner for when we want something extra, like a survey or Community Day notice */
   /*  var extra_banner =
      '<div id="latest_extra_banner_id" class="admonition important">' +
        '<p style="padding-bottom: 1.2rem;">' +
        'Discuss Ansible in the new <a href="https://forum.ansible.com/t/welcome-to-the-ansible-community/5">Ansible Forum!</a>' +
        '</p>' +
      '</div>';
      */
    // Create a banner if we're not on the official docs site
    if (location.host == "docs.testing.ansible.com") {
      document.write('<div id="testing_banner_id" class="admonition important">' +
                     '<p>This is the testing site for Ansible Documentation. Unless you are reviewing pre-production changes, please visit the <a href="https://docs.ansible.com/ansible/latest/">official documentation website</a>.</p> <p></p>' +
                     '</div>');
    }
    
      // Create a banner
      current_url_path = window.location.pathname;

      var important = false;
      var msg = '<p>';
      if (startsWith(current_url_path, "/ansible-core/")) {
        msg += 'You are reading documentation for Ansible Core, which contains no plugins except for those in ansible.builtin. For documentation of the Ansible package, go to <a href="/ansible/latest">the latest documentation</a>.';
      } else if (startsWithOneOf(current_url_path, ["/ansible/latest/", "/ansible/10/"])) {
        /* temp extra banner to advertise something */
        banner += extra_banner;

        msg += 'This is the <b>latest</b> (stable) Ansible community documentation. For Red Hat Ansible Automation Platform subscriptions, see <a href="https://access.redhat.com/support/policy/updates/ansible-automation-platform">Life Cycle</a> for version details.';
      } else if (startsWith(current_url_path, "/ansible/2.9/")) {
        msg += 'You are reading the latest Red Hat released version of the Ansible documentation. Community users can use this version, or select <b>latest</b> from the version selector to the left for the most recent community version.';
      } else if (startsWith(current_url_path, "/ansible/devel/")) {
        /* temp extra banner to advertise something */
        banner += extra_banner;

        msg += 'You are reading the <b>devel</b> version of the Ansible documentation - this version is not guaranteed stable. Use the version selection to the left if you want the <b>latest</b> (stable) released version.';
      } else {
        msg += 'You are reading an older version of the Ansible documentation. Use the version selection to the left if you want the <b>latest</b> (stable) released version.';
        /* temp extra banner to advertise something - this is for testing*/
        banner += extra_banner;

      }
      msg += '</p>';

      banner += '<div id="banner_id" class="admonition ';
      banner += important ? 'important' : 'caution';
      banner += '">';
      banner += important ? '<br>' : '';
      banner += msg;
      banner += important ? '<br>' : '';
      banner += '</div>';
      document.write(banner);
    
  </script>


  
           <div itemprop="articleBody">
             
  <section id="ansible-and-python-3">
<span id="developing-python-3"></span><h1>Ansible and Python 3<a class="headerlink" href="#ansible-and-python-3" title="Link to this heading"></a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">ansible-core</span></code> code runs Python 3 (for specific versions check <a class="reference internal" href="../installation_guide/intro_installation.html#control-node-requirements"><span class="std std-ref">Control Node Requirements</span></a>
Contributors to <code class="docutils literal notranslate"><span class="pre">ansible-core</span></code> and to Ansible Collections should be aware of the tips in this document so that they can write code
that will run on the same versions of Python as the rest of Ansible.</p>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#minimum-version-of-python-3-x-and-python-2-x" id="id1">Minimum version of Python 3.x and Python 2.x</a></p></li>
<li><p><a class="reference internal" href="#developing-ansible-code-that-supports-python-2-and-python-3" id="id2">Developing Ansible code that supports Python 2 and Python 3</a></p>
<ul>
<li><p><a class="reference internal" href="#understanding-strings-in-python-2-and-python-3" id="id3">Understanding strings in Python 2 and Python 3</a></p>
<ul>
<li><p><a class="reference internal" href="#control-node-string-strategy-the-unicode-sandwich" id="id4">Control node string strategy: the Unicode Sandwich</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#unicode-sandwich-common-borders-places-to-convert-bytes-to-text-in-control-node-code" id="id5">Unicode Sandwich common borders: places to convert bytes to text in control node code</a></p>
<ul>
<li><p><a class="reference internal" href="#reading-and-writing-to-files" id="id6">Reading and writing to files</a></p></li>
<li><p><a class="reference internal" href="#filesystem-interaction" id="id7">Filesystem interaction</a></p></li>
<li><p><a class="reference internal" href="#interacting-with-other-programs" id="id8">Interacting with other programs</a></p></li>
<li><p><a class="reference internal" href="#module-string-strategy-native-string" id="id9">Module string strategy: Native String</a></p></li>
<li><p><a class="reference internal" href="#module-utils-string-strategy-hybrid" id="id10">Module_utils string strategy: hybrid</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#tips-tricks-and-idioms-for-python-2-python-3-compatibility" id="id11">Tips, tricks, and idioms for Python 2/Python 3 compatibility</a></p>
<ul>
<li><p><a class="reference internal" href="#use-forward-compatibility-boilerplate" id="id12">Use forward-compatibility boilerplate</a></p></li>
<li><p><a class="reference internal" href="#prefix-byte-strings-with-b" id="id13">Prefix byte strings with <code class="docutils literal notranslate"><span class="pre">b_</span></code></a></p></li>
<li><p><a class="reference internal" href="#import-ansible-s-bundled-python-six-library" id="id14">Import Ansible’s bundled Python <code class="docutils literal notranslate"><span class="pre">six</span></code> library</a></p></li>
<li><p><a class="reference internal" href="#handle-exceptions-with-as" id="id15">Handle exceptions with <code class="docutils literal notranslate"><span class="pre">as</span></code></a></p></li>
<li><p><a class="reference internal" href="#update-octal-numbers" id="id16">Update octal numbers</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#string-formatting-for-control-node-code" id="id17">String formatting for control node code</a></p>
<ul>
<li><p><a class="reference internal" href="#use-str-format-for-python-2-6-compatibility" id="id18">Use <code class="docutils literal notranslate"><span class="pre">str.format()</span></code> for Python 2.6 compatibility</a></p></li>
<li><p><a class="reference internal" href="#use-percent-format-with-byte-strings" id="id19">Use percent format with byte strings</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
<p>We do have some considerations depending on the types of Ansible code:</p>
<ol class="arabic simple">
<li><p>code on the control node - code that runs on the machine where you invoke <strong class="command">/usr/bin/ansible</strong>, only needs to support the control node’s Python versions.</p></li>
<li><p>modules - the code which Ansible transmits to and invokes on the managed machine. Modules need to support the ‘managed node’ Python versions, with some exceptions.</p></li>
<li><p>shared <code class="docutils literal notranslate"><span class="pre">module_utils</span></code> code - the common code that is  used by modules to perform tasks and sometimes used by code on the control node. Shared <code class="docutils literal notranslate"><span class="pre">module_utils</span></code> code needs to support the same range of Python as the modules.</p></li>
</ol>
<p>However, the three types of code do not use the same string strategy. If you’re developing a module or some <code class="docutils literal notranslate"><span class="pre">module_utils</span></code> code, be sure to read the section on string strategy carefully.</p>
<section id="minimum-version-of-python-3-x-and-python-2-x">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">Minimum version of Python 3.x and Python 2.x</a><a class="headerlink" href="#minimum-version-of-python-3-x-and-python-2-x" title="Link to this heading"></a></h2>
<p>See <a class="reference internal" href="../installation_guide/intro_installation.html#control-node-requirements"><span class="std std-ref">Control Node Requirements</span></a> and <a class="reference internal" href="../installation_guide/intro_installation.html#managed-node-requirements"><span class="std std-ref">Managed Node Requirements</span></a> for the
specific versions supported.</p>
<p>Your custom modules can support any version of Python (or other languages) you want, but the above are the requirements for the code contributed to the Ansible project.</p>
</section>
<section id="developing-ansible-code-that-supports-python-2-and-python-3">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Developing Ansible code that supports Python 2 and Python 3</a><a class="headerlink" href="#developing-ansible-code-that-supports-python-2-and-python-3" title="Link to this heading"></a></h2>
<p>The best place to start learning about writing code that supports both Python 2 and Python 3
is <a class="reference external" href="http://python3porting.com/">Lennart Regebro’s book: Porting to Python 3</a>.
The book describes several strategies for porting to Python 3. The one we’re
using is <a class="reference external" href="http://python3porting.com/strategies.html#python-2-and-python-3-without-conversion">to support Python 2 and Python 3 from a single code base</a></p>
<section id="understanding-strings-in-python-2-and-python-3">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">Understanding strings in Python 2 and Python 3</a><a class="headerlink" href="#understanding-strings-in-python-2-and-python-3" title="Link to this heading"></a></h3>
<p>Python 2 and Python 3 handle strings differently, so when you write code that supports Python 3
you must decide what string model to use.  Strings can be an array of bytes (like in C) or
they can be an array of text.  Text is what we think of as letters, digits,
numbers, other printable symbols, and a small number of unprintable “symbols”
(control codes).</p>
<p>In Python 2, the two types for these (<a class="reference external" href="https://docs.python.org/2/library/functions.html#str" title="(in Python v2.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> for bytes and
<a class="reference external" href="https://docs.python.org/2/library/functions.html#unicode" title="(in Python v2.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">unicode</span></code></a> for text) are often used interchangeably.  When dealing only
with ASCII characters, the strings can be combined, compared, and converted
from one type to another automatically.  When non-ASCII characters are
introduced, Python 2 starts throwing exceptions due to not knowing what encoding
the non-ASCII characters should be in.</p>
<p>Python 3 changes this behavior by making the separation between bytes (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a>)
and text (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>) more strict.  Python 3 will throw an exception when
trying to combine and compare the two types.  The programmer has to explicitly
convert from one type to the other to mix values from each.</p>
<p>In Python 3 it is immediately apparent to the programmer when code is
mixing the byte and text types inappropriately, whereas in Python 2, code that mixes those types
may work until a user causes an exception by entering non-ASCII input.
Python 3 forces programmers to proactively define a strategy for
working with strings in their program so that they don’t mix text and byte strings unintentionally.</p>
<p>Ansible uses different strategies for working with strings in the code on the control node, in
:ref: <cite>modules &lt;module_string_strategy&gt;</cite>, and in <a class="reference internal" href="#module-utils-string-strategy"><span class="std std-ref">module_utils</span></a> code.</p>
<section id="control-node-string-strategy-the-unicode-sandwich">
<span id="control-node-string-strategy"></span><h4><a class="toc-backref" href="#id4" role="doc-backlink">Control node string strategy: the Unicode Sandwich</a><a class="headerlink" href="#control-node-string-strategy-the-unicode-sandwich" title="Link to this heading"></a></h4>
<p>Until recently <code class="docutils literal notranslate"><span class="pre">ansible-core</span></code> supported Python 2.x and followed this strategy, known as the Unicode Sandwich (named
after Python 2’s <a class="reference external" href="https://docs.python.org/2/library/functions.html#unicode" title="(in Python v2.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">unicode</span></code></a> text type).  For Unicode Sandwich we know that
at the border of our code and the outside world (for example, file and network IO,
environment variables, and some library calls) we are going to receive bytes.
We need to transform these bytes into text and use that throughout the
internal portions of our code.  When we have to send those strings back out to
the outside world we first convert the text back into bytes.
To visualize this, imagine a ‘sandwich’ consisting of a top and bottom layer
of bytes, a layer of conversion between, and all text type in the center.</p>
<p>For compatibility reasons you will see a bunch of custom functions we developed (<code class="docutils literal notranslate"><span class="pre">to_text</span></code>/<code class="docutils literal notranslate"><span class="pre">to_bytes</span></code>/<code class="docutils literal notranslate"><span class="pre">to_native</span></code>)
and while Python 2 is not a concern anymore we will continue to use them as they apply for other cases that make
dealing with unicode problematic.</p>
<p>While we will not be using it most of it anymore, the documentation below is still useful for those developing modules
that still need to support both Python 2 and 3 simultaneously.</p>
</section>
</section>
<section id="unicode-sandwich-common-borders-places-to-convert-bytes-to-text-in-control-node-code">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">Unicode Sandwich common borders: places to convert bytes to text in control node code</a><a class="headerlink" href="#unicode-sandwich-common-borders-places-to-convert-bytes-to-text-in-control-node-code" title="Link to this heading"></a></h3>
<p>This is a partial list of places where we have to convert to and from bytes
when using the Unicode Sandwich string strategy. It is not exhaustive but
it gives you an idea of where to watch for problems.</p>
<section id="reading-and-writing-to-files">
<h4><a class="toc-backref" href="#id6" role="doc-backlink">Reading and writing to files</a><a class="headerlink" href="#reading-and-writing-to-files" title="Link to this heading"></a></h4>
<p>In Python 2, reading from files yields bytes.  In Python 3, it can yield text.
To make code that’s portable to both we don’t make use of Python 3’s ability
to yield text but instead do the conversion explicitly ourselves. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ansible.module_utils.common.text.converters</span> <span class="kn">import</span> <span class="n">to_text</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;filename-with-utf8-data.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">my_file</span><span class="p">:</span>
    <span class="n">b_data</span> <span class="o">=</span> <span class="n">my_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">to_text</span><span class="p">(</span><span class="n">b_data</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;surrogate_or_strict&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">UnicodeError</span><span class="p">:</span>
        <span class="c1"># Handle the exception gracefully -- usually by displaying a good</span>
        <span class="c1"># user-centric error message that can be traced back to this piece</span>
        <span class="c1"># of code.</span>
        <span class="k">pass</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Much of Ansible assumes that all encoded text is UTF-8.  At some
point, if there is demand for other encodings we may change that, but for
now it is safe to assume that bytes are UTF-8.</p>
</div>
<p>Writing to files is the opposite process:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ansible.module_utils.common.text.converters</span> <span class="kn">import</span> <span class="n">to_bytes</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;filename.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">my_file</span><span class="p">:</span>
    <span class="n">my_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">to_bytes</span><span class="p">(</span><span class="n">some_text_string</span><span class="p">))</span>
</pre></div>
</div>
<p>Note that we don’t have to catch <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#UnicodeError" title="(in Python v3.12)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">UnicodeError</span></code></a> here because we’re
transforming to UTF-8 and all text strings in Python can be transformed back
to UTF-8.</p>
</section>
<section id="filesystem-interaction">
<h4><a class="toc-backref" href="#id7" role="doc-backlink">Filesystem interaction</a><a class="headerlink" href="#filesystem-interaction" title="Link to this heading"></a></h4>
<p>Dealing with file names often involves dropping back to bytes because on UNIX-like
systems file names are bytes.  On Python 2, if we pass a text string to these
functions, the text string will be converted to a byte string inside of the
function and a traceback will occur if non-ASCII characters are present.  In
Python 3, a traceback will only occur if the text string can’t be decoded in
the current locale, but it is still good to be explicit and have code which
works on both versions:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os.path</span>

<span class="kn">from</span> <span class="nn">ansible.module_utils.common.text.converters</span> <span class="kn">import</span> <span class="n">to_bytes</span>

<span class="n">filename</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39;/var/tmp/くらとみ.txt&#39;</span>
<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">to_bytes</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span>
<span class="n">mtime</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">to_bytes</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
<span class="n">b_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expandvars</span><span class="p">(</span><span class="n">to_bytes</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">to_bytes</span><span class="p">(</span><span class="n">filename</span><span class="p">)):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>When you are only manipulating a filename as a string without talking to the
filesystem (or a C library which talks to the filesystem) you can often get
away without converting to bytes:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os.path</span>

<span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;/var/tmp/café&#39;</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;くらとみ&#39;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;/var/tmp/café/くらとみ&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>On the other hand, if the code needs to manipulate the file name and also talk
to the filesystem, it can be more convenient to transform to bytes right away
and manipulate in bytes.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Make sure all variables passed to a function are the same type.
If you’re working with something like <a class="reference external" href="https://docs.python.org/3/library/os.path.html#os.path.join" title="(in Python v3.12)"><code class="docutils literal notranslate"><span class="pre">os.path.join()</span></code></a> which takes
multiple strings and uses them in combination, you need to make sure that
all the types are the same (either all bytes or all text).  Mixing
bytes and text will cause tracebacks.</p>
</div>
</section>
<section id="interacting-with-other-programs">
<h4><a class="toc-backref" href="#id8" role="doc-backlink">Interacting with other programs</a><a class="headerlink" href="#interacting-with-other-programs" title="Link to this heading"></a></h4>
<p>Interacting with other programs goes through the operating system and
C libraries and operates on things that the UNIX kernel defines.  These
interfaces are all byte-oriented so the Python interface is byte oriented as
well.  On both Python 2 and Python 3, byte strings should be given to Python’s
subprocess library and byte strings should be expected back from it.</p>
<p>One of the main places in Ansible’s control node code that we interact with
other programs is the connection plugins’ <code class="docutils literal notranslate"><span class="pre">exec_command</span></code> methods.  These
methods transform any text strings they receive in the command (and arguments
to the command) to execute into bytes and return stdout and stderr as byte strings
Higher level functions (like action plugins’ <code class="docutils literal notranslate"><span class="pre">_low_level_execute_command</span></code>)
transform the output into text strings.</p>
</section>
<section id="module-string-strategy-native-string">
<span id="module-string-strategy"></span><h4><a class="toc-backref" href="#id9" role="doc-backlink">Module string strategy: Native String</a><a class="headerlink" href="#module-string-strategy-native-string" title="Link to this heading"></a></h4>
<p>In modules we use a strategy known as Native Strings. This makes things
easier on the community members who maintain so many of Ansible’s
modules, by not breaking backwards compatibility by
mandating that all strings inside of modules are text and converting between
text and bytes at the borders.</p>
<p>Native strings refer to the type that Python uses when you specify a bare
string literal:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;This is a native string&quot;</span>
</pre></div>
</div>
<p>In Python 2, these are byte strings. In Python 3 these are text strings. Modules should be
coded to expect bytes on Python 2 and text on Python 3.</p>
</section>
<section id="module-utils-string-strategy-hybrid">
<span id="module-utils-string-strategy"></span><h4><a class="toc-backref" href="#id10" role="doc-backlink">Module_utils string strategy: hybrid</a><a class="headerlink" href="#module-utils-string-strategy-hybrid" title="Link to this heading"></a></h4>
<p>In <code class="docutils literal notranslate"><span class="pre">module_utils</span></code> code we use a hybrid string strategy. Although Ansible’s
<code class="docutils literal notranslate"><span class="pre">module_utils</span></code> code is largely like module code, some pieces of it are
used by the control node as well. So it needs to be compatible with modules
and with the control node’s assumptions, particularly the string strategy.
The module_utils code attempts to accept native strings as input
to its functions and emit native strings as their output.</p>
<p>In <code class="docutils literal notranslate"><span class="pre">module_utils</span></code> code:</p>
<ul class="simple">
<li><p>Functions <strong>must</strong> accept string parameters as either text strings or byte strings.</p></li>
<li><p>Functions may return either the same type of string as they were given or the native string type for the Python version they are run on.</p></li>
<li><p>Functions that return strings <strong>must</strong> document whether they return strings of the same type as they were given or native strings.</p></li>
</ul>
<p>Module-utils functions are therefore often very defensive in nature.
They convert their string parameters into text (using <code class="docutils literal notranslate"><span class="pre">ansible.module_utils.common.text.converters.to_text</span></code>)
at the beginning of the function, do their work, and then convert
the return values into the native string type (using <code class="docutils literal notranslate"><span class="pre">ansible.module_utils.common.text.converters.to_native</span></code>)
or back to the string type that their parameters received.</p>
</section>
</section>
<section id="tips-tricks-and-idioms-for-python-2-python-3-compatibility">
<h3><a class="toc-backref" href="#id11" role="doc-backlink">Tips, tricks, and idioms for Python 2/Python 3 compatibility</a><a class="headerlink" href="#tips-tricks-and-idioms-for-python-2-python-3-compatibility" title="Link to this heading"></a></h3>
<section id="use-forward-compatibility-boilerplate">
<h4><a class="toc-backref" href="#id12" role="doc-backlink">Use forward-compatibility boilerplate</a><a class="headerlink" href="#use-forward-compatibility-boilerplate" title="Link to this heading"></a></h4>
<p>Use the following boilerplate code at the top of all python files
to make certain constructs act the same way on Python 2 and Python 3:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make coding more python3-ish</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="p">(</span><span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span><span class="p">)</span>
<span class="n">__metaclass__</span> <span class="o">=</span> <span class="nb">type</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">__metaclass__</span> <span class="pre">=</span> <span class="pre">type</span></code> makes all classes defined in the file into new-style
classes without explicitly inheriting from <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">__future__</span></code> imports do the following:</p>
<dl class="field-list simple">
<dt class="field-odd">absolute_import<span class="colon">:</span></dt>
<dd class="field-odd"><p>Makes imports look in <a class="reference external" href="https://docs.python.org/3/library/sys.html#sys.path" title="(in Python v3.12)"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.path</span></code></a> for the modules being
imported, skipping the directory in which the module doing the importing
lives.  If the code wants to use the directory in which the module doing
the importing, there’s a new dot notation to do so.</p>
</dd>
<dt class="field-even">division<span class="colon">:</span></dt>
<dd class="field-even"><p>Makes division of integers always return a float.  If you need to
find the quotient use <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">//</span> <span class="pre">y</span></code> instead of <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">/</span> <span class="pre">y</span></code>.</p>
</dd>
<dt class="field-odd">print_function<span class="colon">:</span></dt>
<dd class="field-odd"><p>Changes <a class="reference external" href="https://docs.python.org/3/library/functions.html#print" title="(in Python v3.12)"><code class="xref py py-func docutils literal notranslate"><span class="pre">print</span></code></a> from a keyword into a function.</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.python.org/dev/peps/pep-0328/#guido-s-decision">PEP 0328: Absolute Imports</a></p></li>
<li><p><a class="reference external" href="https://www.python.org/dev/peps/pep-0238">PEP 0238: Division</a></p></li>
<li><p><a class="reference external" href="https://www.python.org/dev/peps/pep-3105">PEP 3105: Print function</a></p></li>
</ul>
</div>
</section>
<section id="prefix-byte-strings-with-b">
<h4><a class="toc-backref" href="#id13" role="doc-backlink">Prefix byte strings with <code class="docutils literal notranslate"><span class="pre">b_</span></code></a><a class="headerlink" href="#prefix-byte-strings-with-b" title="Link to this heading"></a></h4>
<p>Since mixing text and bytes types leads to tracebacks we want to be clear
about what variables hold text and what variables hold bytes.  We do this by
prefixing any variable holding bytes with <code class="docutils literal notranslate"><span class="pre">b_</span></code>.  For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39;/var/tmp/café.txt&#39;</span>
<span class="n">b_filename</span> <span class="o">=</span> <span class="n">to_bytes</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">b_filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>
</div>
<p>We do not prefix the text strings instead because we only operate
on byte strings at the borders, so there are fewer variables that need bytes
than text.</p>
</section>
<section id="import-ansible-s-bundled-python-six-library">
<h4><a class="toc-backref" href="#id14" role="doc-backlink">Import Ansible’s bundled Python <code class="docutils literal notranslate"><span class="pre">six</span></code> library</a><a class="headerlink" href="#import-ansible-s-bundled-python-six-library" title="Link to this heading"></a></h4>
<p>The third-party Python <a class="reference external" href="https://pypi.org/project/six/">six</a> library exists
to help projects create code that runs on both Python 2 and Python 3.  Ansible
includes a version of the library in module_utils so that other modules can use it
without requiring that it is installed on the remote system.  To make use of
it, import it like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ansible.module_utils</span> <span class="kn">import</span> <span class="n">six</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Ansible can also use a system copy of six</p>
<p>Ansible will use a system copy of six if the system copy is a later
version than the one Ansible bundles.</p>
</div>
</section>
<section id="handle-exceptions-with-as">
<h4><a class="toc-backref" href="#id15" role="doc-backlink">Handle exceptions with <code class="docutils literal notranslate"><span class="pre">as</span></code></a><a class="headerlink" href="#handle-exceptions-with-as" title="Link to this heading"></a></h4>
<p>In order for code to function on Python 2.6+ and Python 3, use the
new exception-catching syntax which uses the <code class="docutils literal notranslate"><span class="pre">as</span></code> keyword:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">a</span> <span class="o">=</span> <span class="mi">2</span><span class="o">/</span><span class="mi">0</span>
<span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">module</span><span class="o">.</span><span class="n">fail_json</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Tried to divide by zero: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>
</pre></div>
</div>
<p>Do <strong>not</strong> use the following syntax as it will fail on every version of Python 3:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>try:
    a = 2/0
except ValueError, e:
    module.fail_json(msg=&quot;Tried to divide by zero: %s&quot; % e)
</pre></div>
</div>
</section>
<section id="update-octal-numbers">
<h4><a class="toc-backref" href="#id16" role="doc-backlink">Update octal numbers</a><a class="headerlink" href="#update-octal-numbers" title="Link to this heading"></a></h4>
<p>In Python 2.x, octal literals could be specified as <code class="docutils literal notranslate"><span class="pre">0755</span></code>.  In Python 3,
octals must be specified as <code class="docutils literal notranslate"><span class="pre">0o755</span></code>.</p>
</section>
</section>
<section id="string-formatting-for-control-node-code">
<h3><a class="toc-backref" href="#id17" role="doc-backlink">String formatting for control node code</a><a class="headerlink" href="#string-formatting-for-control-node-code" title="Link to this heading"></a></h3>
<section id="use-str-format-for-python-2-6-compatibility">
<h4><a class="toc-backref" href="#id18" role="doc-backlink">Use <code class="docutils literal notranslate"><span class="pre">str.format()</span></code> for Python 2.6 compatibility</a><a class="headerlink" href="#use-str-format-for-python-2-6-compatibility" title="Link to this heading"></a></h4>
<p>Starting in Python 2.6, strings gained a method called <code class="docutils literal notranslate"><span class="pre">format()</span></code> to put
strings together.  However, one commonly used feature of <code class="docutils literal notranslate"><span class="pre">format()</span></code> wasn’t
added until Python 2.7, so you need to remember not to use it in Ansible code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Does not work in Python 2.6!</span>
<span class="n">new_string</span> <span class="o">=</span> <span class="s2">&quot;Dear </span><span class="si">{}</span><span class="s2">, Welcome to </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">location</span><span class="p">)</span>

<span class="c1"># Use this instead</span>
<span class="n">new_string</span> <span class="o">=</span> <span class="s2">&quot;Dear </span><span class="si">{0}</span><span class="s2">, Welcome to </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">location</span><span class="p">)</span>
</pre></div>
</div>
<p>Both of the format strings above map positional arguments of the <code class="docutils literal notranslate"><span class="pre">format()</span></code>
method into the string.  However, the first version doesn’t work in
Python 2.6.  Always remember to put numbers into the placeholders so the code
is compatible with Python 2.6.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>Python documentation on format strings:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.python.org/2.6/library/string.html#formatstrings">format strings in 2.6</a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/string.html#formatstrings">format strings in 3.x</a></p></li>
</ul>
</div>
</section>
<section id="use-percent-format-with-byte-strings">
<h4><a class="toc-backref" href="#id19" role="doc-backlink">Use percent format with byte strings</a><a class="headerlink" href="#use-percent-format-with-byte-strings" title="Link to this heading"></a></h4>
<p>In Python 3.x, byte strings do not have a <code class="docutils literal notranslate"><span class="pre">format()</span></code> method.  However, it
does have support for the older, percent-formatting.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">b_command_line</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;ansible-playbook --become-user </span><span class="si">%s</span><span class="s1"> -K </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">playbook_file</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Percent formatting added in Python 3.5</p>
<p>Percent formatting of byte strings was added back into Python 3 in 3.5.
This isn’t a problem for us because Python 3.5 is our minimum version.
However, if you happen to be testing Ansible code with Python 3.4 or
earlier, you will find that the byte string formatting here won’t work.
Upgrade to Python 3.5 to test.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>Python documentation on <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#string-formatting">percent formatting</a></p>
</div>
<span class="target" id="testing-modules-python-3"></span></section>
</section>
</section>
</section>


           </div>
          </div>
          

<footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="developing_modules_best_practices.html" class="btn btn-neutral float-left" title="Conventions, tips, and pitfalls" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="debugging.html" class="btn btn-neutral float-right" title="Debugging modules" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Ansible project contributors.
      <span class="lastupdated">Last updated on Jun 18, 2024.
      </span></p>
  </div>

  
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script><!-- extra footer elements for Ansible beyond RTD Sphinx Theme -->
<!-- begin analytics -->
<script>
var _hsq = _hsq || [];
_hsq.push(["setContentType", "standard-page"]);
      (function(d,s,i,r) {
      if (d.getElementById(i)){return;}
      var n = d.createElement(s),e = document.getElementsByTagName(s)[0];
      n.id=i;n.src = 'https://js.hs-analytics.net/analytics/'+(Math.ceil(new Date()/r)*r)+'/330046.js';
      e.parentNode.insertBefore(n, e);
      })(document, "script", "hs-analytics",300000);
</script>
<!-- end analytics -->
<script>
if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
  _satellite.pageBottom();
}
</script>

</body>
</html>